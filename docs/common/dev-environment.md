> **Правила для ИИ:** определение ОС и адаптация команд

# Определение операционной системы

Определять ОС пользователя по доступным данным (user_info, терминальные метаданные). Подстраивать команды/пути под выявленную систему.

## Порядок определения

1. Использовать данные из контекста сессии (поле "OS Version")
2. Однократно выполнять определение командой, если данных нет
3. Сохранять результат в контекст без повторных вызовов

## Настройки по ОС

| ОС      | Определение                       | Разделитель пути | Shell          |
| ------- | --------------------------------- | ---------------- | -------------- |
| Windows | `systeminfo`                      | `\`              | PowerShell/cmd |
| macOS   | `sw_vers`, `uname -a`             | `/`              | bash/zsh       |
| Linux   | `cat /etc/os-release`, `uname -a` | `/`              | bash/zsh       |

## Цепочка команд (command chaining)

| Shell      | Последовательное выполнение | Условное выполнение (только если предыдущая успешна) |
| ---------- | --------------------------- | ---------------------------------------------------- |
| PowerShell | `;` (во всех версиях)       | `&&` только в PowerShell 7+                          |
| Bash/Zsh   | `;`                         | `&&`                                                 |

**Приоритет:** где `&&` поддерживается (Bash/Zsh, PowerShell 7+), использовать `&&` всегда, кроме случаев, когда `;` необходим — например, если следующая команда должна выполниться даже при ошибке предыдущей (например, cleanup).

**Для Windows + PowerShell:** использовать `;` вместо `&&` для объединения команд — `&&` не поддерживается в PowerShell 5.x (стандартная версия в Windows).

```powershell
# ✓ Правильно (PowerShell)
cd "h:\project"; git status; git pull

# ✗ Неправильно (не работает в PowerShell 5.x)
cd "h:\project" && git status && git pull
```

```bash
# ✓ Предпочтительно (Bash/Zsh) — останавливается при ошибке
cd /path/to/project && git status && git pull

# Использовать ; только когда следующая команда должна выполниться даже при ошибке предыдущей
run_tests; rm -rf .tmp  # cleanup в любом случае
```

## Если ОС не определена

- Спросить у пользователя явно
- После уточнения давать команды под соответствующую ОС
- Использовать кроссплатформенные команды (`node`, `npm`, `git`)

## Чеклист выполнения команд

- [ ] ОС определена из контекста или командой
- [ ] Команды адаптированы под ОС
- [ ] Пути используют правильный разделитель
- [ ] Shell учтён (PowerShell/bash/zsh)
