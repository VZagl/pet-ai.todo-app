> **Правила для ИИ:** использование Memory Bank System

# Memory Bank System - Правила использования

## Приоритет правил

**КРИТИЧНО**: Правила из `AGENTS.md` имеют **приоритет** над инструкциями Memory Bank System.

## Основные требования

- **Отвечать на русском языке**, адаптируя примеры из Memory Bank System
- **Запрашивать подтверждение** перед созданием/изменением файлов Memory Bank
- **Показывать план изменений** перед применением
- **Следовать правилам проекта** из `AGENTS.md`

## Подтверждение изменений

Перед созданием/изменением файлов Memory Bank:

1. Показать план изменений (какие файлы, что изменено)
2. Запросить явное подтверждение ("Создать структуру?", "Обновить tasks.md?")
3. Только после подтверждения выполнять операции

**Исключения** (подтверждение НЕ требуется):

- Чтение файлов Memory Bank
- Проверка существования файлов/директорий
- Анализ содержимого без изменений

**Пример:**

```
Ассистент: "Для инициализации Memory Bank нужно создать:
- Директория: memory-bank/
- Файлы: tasks.md, activeContext.md, progress.md (список сокращён)

Создать структуру?"
[ЖДЁТ ПОДТВЕРЖДЕНИЯ]
```

## Режимы Memory Bank

**Доступные режимы:**

- **VAN** - Инициализация и входная точка
- **PLAN** - Планирование
- **CREATIVE** - Дизайн-решения
- **BUILD** - Реализация
- **REFLECT** - Рефлексия и обзор
- **ARCHIVE** - Документация

**При использовании любого режима:**

1. Все ответы на русском языке
2. Запрашивать подтверждение перед изменениями
3. Показывать план перед применением
4. Следовать правилам из `AGENTS.md`

## Структура файлов Memory Bank

Все файлы Memory Bank находятся в `memory-bank/`:

- `tasks.md` - Отслеживание задач
- `activeContext.md` - Текущий фокус
- `progress.md` - Статус реализации
- `projectbrief.md` - Основа проекта
- `productContext.md` - Контекст продукта
- `systemPatterns.md` - Паттерны системы
- `techContext.md` - Технический контекст
- `style-guide.md` - Руководство по стилю
- `backlog.md` - Планировщик задач (только активные задачи и идеи)
- `creative/creative-[feature_name].md` - Решения по дизайну
- `reflection/reflection-[task_id].md` - Рефлексия по задачам
- `archive/archive-[task_id].md` - Архив задач
- `completed-tasks/` - Журнал завершённых задач

**Перед созданием файла:**

1. Проверить существование директории `memory-bank/`
2. Показать план создания
3. Запросить подтверждение

## Журнал завершённых задач (completed-tasks/)

### Назначение

Единый реестр всех завершённых задач проекта. Каждая задача — отдельный файл-карточка с метаданными, описанием и ссылками на артефакты (archive, reflection).

### Структура каталога

```
memory-bank/completed-tasks/
  _template.md              — шаблон карточки
  YYYY/                     — год создания задачи
    MM/                     — месяц создания задачи
      [task_id]_YYYY-MM-DD.md  — дата завершения в имени файла
```

- **YYYY/MM** — по дате **создания** задачи (когда задача впервые появилась в backlog)
- **YYYY-MM-DD в имени файла** — дата **завершения** задачи

### Шаблон карточки

Шаблон находится в `memory-bank/completed-tasks/_template.md`. Содержит:

- Метаданные: название, даты создания и завершения, уровень сложности, тип
- Задание: полное описание из backlog (как было при постановке)
- Результат: ключевые итоги
- Ссылки: archive, reflection, ветка, коммит (или "—" если отсутствует)

### Связи с archive и reflection

- **Односторонние:** только completed-запись ссылается на archive и reflection
- Файлы archive и reflection **не модифицируются** — остаются в своих каталогах
- Поиск связанных файлов: по task_id в именах файлов

## Финализация задачи (команда /close-task)

### Когда выполняется

**КРИТИЧНО:** Финализация **никогда** не выполняется автоматически. Только пользователь явно запускает `/close-task` после всех фаз задачи.

### Что делает /close-task

1. Создаёт запись в `memory-bank/completed-tasks/YYYY/MM/[task_id]_YYYY-MM-DD.md`
2. Удаляет задачу из `memory-bank/backlog.md` (из активных)
3. Подготавливает Memory Bank к следующей задаче:
   - `tasks.md` — очищает Current Task, переносит в Last Completed (только одна запись; история — в `completed-tasks/`)
   - `activeContext.md` — сбрасывает в IDLE
   - `progress.md` — оставляет только последнюю выполненную задачу (очищает старые записи; история — в `completed-tasks/`)

**Важно:** В `tasks.md` и `progress.md` хранится только последняя завершённая задача. Полная история — в `memory-bank/completed-tasks/`.

Полное описание: `.cursor/commands/close-task.md`.

### Интеграция с /van

При инициализации задачи командой `/van` в чеклист `memory-bank/tasks.md` **обязательно** добавляется финальный пункт:

```markdown
- [ ] CLOSE: Финализировать задачу командой /close-task
```

Этот шаг также указывается в `activeContext.md` → "Next Steps".

## Работа с backlog

### Роль backlog.md

`backlog.md` — **планировщик задач**. Содержит только:

- Активные задачи и идеи, сгруппированные по приоритету
- Примечания по использованию

**Не содержит** истории завершённых задач — она хранится в `completed-tasks/`.

### Добавление новой задачи в backlog

При добавлении новой задачи **обязательно**:

1. **Дата создания** — первая строка после заголовка задачи: `**Создано:** YYYY-MM-DD`
2. **Уникальность Task ID** — если задаче присвоен Task ID (в скобках после названия):
   - Проверить, что такого ID нет в `memory-bank/backlog.md`
   - Проверить, что такого ID нет в `memory-bank/completed-tasks/` (поиск по имени файла)
   - Если дубликат найден — сообщить пользователю и запросить другой ID

**Формат задачи:**

```markdown
- [ ] Название задачи (task-id-001)
  - **Создано:** YYYY-MM-DD
  - Описание и подзадачи...
  - **Связано с**: [связанная задача]
  - **Причина**: [обоснование]
```

### Жизненный цикл задачи из backlog

1. Задача описана в `backlog.md` в разделе соответствующего приоритета
2. `/van` берёт задачу в работу → создаёт запись в `tasks.md`
3. Задача проходит фазы: PLAN → [CREATIVE] → BUILD → REFLECT → [ARCHIVE]
4. `/close-task` финализирует: создаёт completed-запись, удаляет из backlog

## Интеграция с правилами проекта

Memory Bank System совместим с:

- ✅ Правилами командной строки из `AGENTS.md`
- ✅ Правилами MCP и Context7
- ✅ Правилами sequential thinking
- ✅ Структурой проекта

**Адаптация команд:**

- Адаптировать под платформу (Windows/PowerShell, Linux/Bash, macOS/Zsh)
- Использовать правильные разделители путей (`\` для Windows, `/` для Unix)
- Следовать правилам из `AGENTS.md`

## Чеклист Memory Bank

- [ ] `tasks.md` обновлён с текущей задачей
- [ ] `activeContext.md` отражает текущий фокус
- [ ] Завершённая задача перенесена в `archive/` (если нужен архив)
- [ ] Создан файл `reflection/` при необходимости
- [ ] `/close-task` выполнена для финализации задачи
- [ ] Все ответы на русском языке
- [ ] Подтверждение получено перед изменениями

## Резюме

Memory Bank System - инструмент для структурированного управления задачами. Его использование должно полностью соответствовать правилам из `AGENTS.md`. При конфликтах приоритет имеют правила из `AGENTS.md`.
