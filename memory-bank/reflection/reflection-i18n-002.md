# Рефлексия: Украинская локализация (uk)

**Task ID:** i18n-002  
**Название:** Украинская локализация (uk)  
**Дата рефлексии:** 2026-02-16  
**Уровень:** Level 2 — Simple Enhancement

---

## Краткое резюме

Добавлена украинская локаль (uk) в приложение pet.todo: создан `src/locales/uk/translation.json` с полными переводами и плюрализацией (one/few/many), обновлён конфиг i18n, LanguageSwitcher переведён на динамический список из `supportedLngs` с ключом `language.name`. При добавлении нового языка достаточно создать файл переводов и обновить config — компонент подхватывает изменения автоматически.

---

## Что сработало хорошо

1. **Design decision (инициализация)** — выбор динамического подхода для LanguageSwitcher оказался удачным: один ключ `language.name` в каждой локали, список строится из `supportedLngs`, при добавлении uk не потребовалось менять логику компонента — только config и новый файл.
2. **Плюрализация uk** — Intl.PluralRules поддерживает украинский (one/few/many) без дополнительной настройки; структура ключей `task_one`, `task_few`, `task_many` идентична русскому.
3. **Рефакторинг LanguageSwitcher** — удаление константы `LANGUAGES` и переход на `i18n.options.supportedLngs` с фильтрацией `cimode` упростил поддержку; сортировка через `localeCompare` обеспечивает корректный алфавитный порядок (English, Русский, Українська).
4. **План из 5 шагов** — чёткая последовательность (language.name → uk файл → config → LanguageSwitcher → docs/тесты) позволила выполнить задачу без итераций.
5. **i18n-guidelines.md** — уже содержал структуру и правила; добавление uk и примечания о плюрализации заняло минимум времени.

---

## Сложности

1. **Фильтрация supportedLngs** — `i18n.options.supportedLngs` может содержать `'cimode'` (режим CI); потребовалась фильтрация `filter(l => l !== 'cimode')` и type guard для TypeScript.
2. **Сортировка кириллицы** — при трёх языках (en, ru, uk) важно корректное отображение в алфавитном порядке; `localeCompare(a, b)` без указания локали даёт нативную UTF-8 сортировку, что подходит для смешанного латиница+кириллица.
3. **Украинские формы плюрализации** — отличия от русского (задача/задачі/задач vs задача/задачи/задач); потребовалась проверка грамматики для `left_one/few/many` и `completed_one/few/many`.

---

## Применённые решения

1. **cimode** — фильтр `supportedLngs.filter((l: unknown): l is string => l !== 'cimode' && typeof l === 'string')` с type guard для безопасной типизации.
2. **Сортировка** — `t('language.name', { lng: a }).localeCompare(t('language.name', { lng: b }))` — сортировка по названию на родном языке, что даёт естественный порядок для пользователя.
3. **Плюрализация uk** — использованы формы: задача/задачі/задач, залишилась/залишилось/залишилось, завершена/завершено/завершено (сверено с грамматикой украинского).

---

## Технические выводы

1. **Динамический LanguageSwitcher** — паттерн «config + language.name» масштабируется: добавление нового языка = новый файл + одна строка в config; компонент не трогаем.
2. **i18next supportedLngs** — при использовании в production стоит учитывать возможное наличие `cimode` в dev/test; фильтрация обязательна.
3. **localeCompare** — для мультиязычных списков (латиница + кириллица) `localeCompare` без второго аргумента даёт предсказуемый результат в современных браузерах.

---

## Процессные выводы

1. **Design decision на этапе инициализации** — для Level 2 достаточно одного обоснованного решения (динамический vs статический список); creative phase не требовалась.
2. **Challenges & Mitigations в плане** — секция в tasks.md (cimode, сортировка, тесты) заранее определила риски; реализация прошла без сюрпризов.
3. **Тесты** — добавление проверки `language-option-uk` в тест «открывает dropdown» обеспечило покрытие нового языка; обобщение на «≥ 3 опций» не потребовалось, т.к. явная проверка uk даёт лучшую читаемость.

---

## Рекомендации для будущих задач

1. **Добавление языков** — при следующей локали (например, de, pl) следовать тому же паттерну: `language.name`, config, translation.json; LanguageSwitcher уже готов.
2. **Плюрализация** — при добавлении славянских языков (pl, cs и т.д.) проверять Intl.PluralRules для целевого языка; не все используют one/few/many.
3. **E2E смена языка** — рассмотреть опциональный E2E-сценарий проверки `document.documentElement.lang` при переключении (как рекомендовано в reflection-i18n-001).

---

## Метрики

| Метрика            | Значение                                         |
| ------------------ | ------------------------------------------------ |
| Файлов создано     | 1 (`src/locales/uk/translation.json`)            |
| Файлов изменено    | 6 (ru, en, config, LanguageSwitcher, test, docs) |
| Соответствие плану | 100%                                             |
| Отклонения         | Нет                                              |

---

## Следующий шаг

REFLECT завершён. Готово к команде `/archive`.
