# Memory Bank: Tasks

## Current Task

Рефакторинг тестов: деструктуризация `result.current`

## Task ID

test-refactor-result-destructuring-001

## Complexity Level

**Level 1** - Quick Enhancement

**Обоснование:**

- Изменяется только один тестовый файл (`src/hooks/useLocalStorage.test.ts`)
- Простая замена синтаксиса без изменения логики
- Не требует планирования или архитектурных решений
- Низкий риск регрессий (тесты сами валидируют правильность)
- Улучшение читаемости кода

**Workflow:** VAN → BUILD (прямая реализация)

## Status

✅ **COMPLETED** - Задача завершена успешно

**Ветка:** `refactor/test-result-destructuring` ✅ создана
**Коммит:** `f07896e` ✅ создан

**Прогресс:**

- [x] Полный анализ кодовой базы завершён
  - ✅ Проверены все 3 тестовых файла хуков
  - ✅ Найден 1 файл для рефакторинга: `useLocalStorage.test.ts` (11 вхождений)
  - ✅ Проверено: `useFilter.test.ts` - уже правильный стиль (не требует изменений)
  - ✅ Проверено: `useTodos.test.ts` - уже правильный стиль (не требует изменений)
- [x] Показан план изменений пользователю
- [x] Создана ветка `refactor/test-result-destructuring`
- [x] Memory Bank обновлён
- [x] Применить рефакторинг в `useLocalStorage.test.ts` (11 изменений в 7 тестах)
- [x] Запустить тесты для проверки (ожидаем 121/121)
  - ✅ `useLocalStorage.test.ts`: 7/7 тестов проходят
  - ✅ Все тесты проекта: 121/121 проходят
- [x] Создать коммит `f07896e`
- [x] Обновить Memory Bank с финальным статусом

## Source

Задача из `memory-bank/backlog.md` (строки 13-23):

- Рефакторинг тестов: деструктуризация `result.current`
- Проблема: В тестах встречается доступ к сеттеру через `result.current[1](...)`, что ухудшает читаемость
- Решение: Заменить индексный доступ на деструктуризацию с осмысленными именами

## Description

Применить рефакторинг тестов с использованием деструктуризации `result.current` вместо индексного доступа.

**Проблема:**

В тестах `useLocalStorage.test.ts` используется индексный доступ `result.current[0]` и `result.current[1]`, что ухудшает читаемость:

- Непонятно, что означает `[0]` и `[1]`
- Множественные обращения загромождают код
- Не соответствует правилу из `docs/project/testing-guidelines.md`

**Цель:**

Улучшить читаемость тестов, заменив индексный доступ на деструктуризацию с осмысленными именами переменных.

**Решение:**

Заменить все вхождения индексного доступа:

- `result.current[0]` → `const [storedValue] = result.current`
- `result.current[1](...)` → `const [storedValue, setStoredValue] = result.current; setStoredValue(...)`

**Scope:**

- 1 файл: `src/hooks/useLocalStorage.test.ts`
- 7 тестов
- 11 изменений

## Technology Stack

- Markdown для документации
- Git для контроля версий

## Requirements

### Функциональные требования (FR)

1. **FR-01**: Заменить все индексные доступы `result.current[0]` на деструктуризацию
2. **FR-02**: Заменить все вызовы `result.current[1](...)` на деструктуризацию с вызовом функции
3. **FR-03**: Использовать осмысленные имена: `storedValue`, `setStoredValue`
4. **FR-04**: Сохранить логику всех 7 тестов без изменений
5. **FR-05**: Все 121 теста должны проходить после рефакторинга

### Нефункциональные требования (NFR)

1. **NFR-01**: Улучшение читаемости кода
2. **NFR-02**: Соответствие правилу из `docs/project/testing-guidelines.md`
3. **NFR-03**: Консистентность стиля во всех тестах хуков

## Files to Modify

1. **`src/hooks/useLocalStorage.test.ts`**
   - **Что:** Заменить 11 вхождений индексного доступа на деструктуризацию
   - **Тесты:** 7 тестов требуют изменений
   - **Строки:** 13, 21, 28, 31, 39, 42, 51, 54, 65, 68, 75

## Implementation Plan

### Шаг 1: Рефакторинг тестов (BUILD фаза)

**Действия:**

1. Открыть файл `src/hooks/useLocalStorage.test.ts`
2. Для каждого из 7 тестов:
   - Добавить деструктуризацию в начале теста: `const [storedValue, setStoredValue] = result.current;`
   - Заменить все `result.current[0]` на `storedValue`
   - Заменить все `result.current[1](...)` на `setStoredValue(...)`
3. Сохранить файл

### Шаг 2: Проверка

**Действия:**

1. Запустить тесты: `pnpm test src/hooks/useLocalStorage.test.ts`
2. Убедиться, что все 7 тестов проходят
3. Запустить все тесты: `pnpm test`
4. Убедиться, что 121/121 тестов проходят

### Шаг 3: Коммит

**Действия:**

1. `git add src/hooks/useLocalStorage.test.ts`
2. Создать коммит с описанием рефакторинга
3. Проверить корректность коммита

### Шаг 4: Обновить Memory Bank и backlog

**Действия:**

1. Обновить `memory-bank/tasks.md` - отметить как COMPLETED
2. Обновить `memory-bank/progress.md` - добавить результаты
3. Обновить `memory-bank/backlog.md` - перенести в завершённые

## Checklist реализации

- [x] Полный анализ кодовой базы
  - [x] Проверить `useLocalStorage.test.ts` - найдено 11 вхождений
  - [x] Проверить `useFilter.test.ts` - уже правильный стиль
  - [x] Проверить `useTodos.test.ts` - уже правильный стиль
- [x] Создать ветку `refactor/test-result-destructuring`
- [x] Показать детальный план изменений пользователю
- [x] Обновить Memory Bank (tasks.md, activeContext.md)
- [x] BUILD фаза: Применить рефакторинг
  - [x] Тест 1: "должен инициализироваться начальным значением"
  - [x] Тест 2: "должен загружать значение из localStorage при инициализации"
  - [x] Тест 3: "должен обновлять значение и сохранять в localStorage"
  - [x] Тест 4: "должен поддерживать функциональное обновление"
  - [x] Тест 5: "должен сохранять сложные объекты"
  - [x] Тест 6: "должен сохранять массивы"
  - [x] Тест 7: "должен использовать начальное значение если localStorage пуст"
- [x] Запустить тесты (ожидаем 121/121) - ✅ 121/121 проходят
- [x] Создать коммит `f07896e`
- [x] Обновить Memory Bank с финальным статусом

**Текущие проблемы:**

- Уже довольно компактный
- Можно добавить чеклист

**Изменения:**

1. Преобразовать список в императивы:
   - "Показывай" → "Показывать"
   - "Замещай" → "Замещать"

2. Сократить примеры:
   - Оставить 1 пример (самый показательный)
   - Убрать дублирующий пример

3. Добавить чеклист проверки:

   ```markdown
   ## Чеклист вывода кода

   - [ ] Показаны только изменяемые фрагменты
   - [ ] Контекст 2-3 строки до/после
   - [ ] Неизменные блоки заменены комментарием
   - [ ] Указаны номера строк для больших файлов
   ```

**Критерии успеха:**

- [ ] Добавлен заголовок "Правила для ИИ"
- [ ] Преобразовано в императивы
- [ ] Убран дублирующий пример
- [ ] Добавлен чеклист вывода кода
- [ ] Все правила однозначно понятны

### Шаг 5: Рефакторинг `docs/common/dev-environment.md`

## Checklist реализации

- [x] Шаг 1: Аудит файлов `docs/` и анализ проблемных зон
- [x] Шаг 1.1: Прочитать все файлы в `docs/common/` и `docs/project/`
- [x] Шаг 1.2: Определить приоритеты рефакторинга
- [x] Шаг 1.3: Создать детальный план для каждого файла
- [x] Шаг 2: Создать единый шаблон "Правила для ИИ" с заголовком
- [x] Шаг 3: Рефакторинг `docs/common/agent-docstyle-rules.md`
- [x] Шаг 4: Рефакторинг `docs/common/agent-editing-rules.md`
- [x] Шаг 5: Рефакторинг `docs/common/agent-output-rules.md`
- [x] Шаг 6: Рефакторинг `docs/common/dev-environment.md`
- [x] Шаг 7: Рефакторинг `docs/common/naming-conventions.md`
- [x] Шаг 8: Рефакторинг `docs/common/git-commit-description.md`
- [x] Шаг 9: Рефакторинг `docs/common/git-workflow.md`
- [x] Шаг 10: Рефакторинг `docs/common/memory-bank-usage.md`
- [x] Шаг 11: Рефакторинг `docs/project/testing-guidelines.md`
- [x] Шаг 12: Проверка консистентности всех файлов
- [x] Шаг 13: Финальная проверка и создание commit
